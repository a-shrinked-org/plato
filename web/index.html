<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Platogram - Transform Audio into Actionable Knowledge</title>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap");
    :root {
      --dark-blue: #00008b;
      --medium-blue: #0000cd;
      --dark-red: #8b0000;
      --medium-red: #cd0000;
      --light-gray: #f0f0f0;
      --lighter-gray: #f8f8f8;
      --white: #ffffff;
      --text-color: #333;
    }
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: "Open Sans", sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: var(--light-gray);
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 100%;
      background-color: var(--white);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    header {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }
    h1,
    h2,
    h3 {
      color: var(--dark-blue);
      text-align: center;
      font-weight: 700;
    }
    h1 {
      font-size: 2.5em;
    }
    h2 {
      font-size: 2em;
    }
    h3 {
      font-size: 1.5em;
    }
    p {
      font-size: 1em;
      line-height: 1.6;
    }
    .cta-container {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      border: 2px solid var(--dark-blue);
      border-radius: 15px;
      background-color: var(--lighter-gray);
    }
    .cta {
      background-color: var(--dark-blue);
      color: var(--white);
      padding: 15px 30px;
      text-decoration: none;
      border-radius: 25px;
      display: inline-block;
      margin: 10px;
      font-size: 1.1em;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    .cta:hover {
      background-color: var(--medium-blue);
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    section {
      margin-bottom: 40px;
      padding: 20px;
      background-color: var(--lighter-gray);
      border-radius: 10px;
      text-align: center;
    }
    ul,
    ol {
      display: inline-block;
      text-align: left;
      padding-left: 20px;
    }
    .examples a {
      display: block;
      margin-bottom: 10px;
      color: var(--dark-blue);
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .examples a:hover {
      color: var(--medium-blue);
      text-decoration: underline;
    }
    .features,
    .use-cases {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }
    .feature,
    .use-case {
      flex-basis: 30%;
      margin-bottom: 20px;
      text-align: left;
    }
    .feature h3 {
      text-align: left;
    }
    .use-case h3 {
      text-align: left;
    }
    input[type="text"] {
      padding: 10px;
      width: 70%;
      margin-bottom: 10px;
      border: 1px solid var(--dark-blue);
      border-radius: 25px;
      font-family: "Open Sans", sans-serif;
      font-size: 1em;
    }
    img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
    .pricing {
      background-color: var(--light-gray);
      padding: 30px;
      border-radius: 15px;
      margin-top: 30px;
    }
    .pricing h3 {
      color: var(--dark-red);
    }
    .hidden {
      display: none !important;
    }
    footer {
      margin-top: 40px;
      padding: 20px;
      background-color: var(--lighter-gray);
      border-radius: 10px;
      text-align: center;
      font-size: 0.9em;
    }
    footer a {
      color: var(--dark-blue);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    footer a:hover {
      color: var(--medium-blue);
      text-decoration: underline;
    }
    .input-wrapper {
  position: relative;
  width: 70%;
  margin: 0 auto;
  display: flex;
  align-items: center;
}

#url-input {
  width: 100%;
  padding: 10px;
  padding-right: 40px;
  box-sizing: border-box;
}

.upload-button {
  position: absolute;
  right: 10px;
  top: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0 10px;
}

.upload-icon {
  font-size: 20px;
  line-height: 1;
  transform: translateY(-5px); /* Adjust this value to fine-tune vertical position */
}

#file-upload {
  position: absolute;
  right: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background-color: white;
  padding: 30px;
  border-radius: 8px;
  text-align: center;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.modal-content h3 {
  margin-top: 0;
  color: var(--dark-blue);
  font-size: 1.5em;
  margin-bottom: 20px;
}

.language-selection,
.price-input {
  margin-bottom: 20px;
}

.language-selection label,
.price-input label {
  display: block;
  margin-bottom: 8px;
  color: var(--dark-blue);
  font-weight: 600;
}

.lang-dropdown,
#price-input,
#card-element {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 1px solid var(--dark-blue);
  border-radius: 5px;
  background-color: white;
  color: var(--dark-blue);
  transition: border-color 0.3s, box-shadow 0.3s;
  box-sizing: border-box;
}

.lang-dropdown:focus,
#price-input:focus {
  outline: none;
  border-color: var(--medium-blue);
  box-shadow: 0 0 0 2px rgba(0, 0, 205, 0.2);
}

.price-explanation {
  font-size: 0.9em;
  color: #666;
  margin-top: 8px;
}

#card-element {
  margin-bottom: 20px;
}

#card-errors {
  color: #fa755a;
  margin-bottom: 15px;
  font-size: 0.9em;
}

.lang-btn {
  padding: 12px 24px;
  background-color: var(--dark-blue);
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: background-color 0.3s;
  margin: 0 10px;
}

.lang-btn:hover {
  background-color: var(--medium-blue);
}
#submit-btn {
  background-color: var(--dark-blue);
}

#submit-btn:hover {
  background-color: var(--medium-blue);
}

#cancel-btn {
  background-color: var(--dark-blue);
}

#cancel-btn:hover {
  background-color: var(--medium-blue);
}

</style>
<body>
  <div id="language-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Select Language and Set Price</h3>
      <div class="language-selection">
        <select id="lang-select" class="lang-dropdown">
          <option value="en">English</option>
          <option value="es">Spanish</option>
        </select>
      </div>
      <div class="price-input">
        <label for="price-input">Name Your Price (USD):</label>
        <input type="number" id="price-input" value="2.00" step="0.01" min="0">
        <p class="price-explanation">
          Suggested: $2/hour. Enter $0 to try for free.
        </p>
      </div>
      <div id="card-element">
        <!-- Stripe Card Element will be inserted here -->
      </div>
      <div id="card-errors" role="alert"></div>
      <button id="submit-btn" class="cta">Submit</button>
      <button id="cancel-btn" class="cta">Cancel</button>
    </div>
  </div>


    <div class="container">
      <header>
        <a href="#" class="cta" onclick="login()" id="login-button">Log In</a>
        <a href="#" class="cta" onclick="logout()" id="logout-button">Log Out</a>
      </header>

      <main>
        <h1>Transform Speech into Knowledge</h1>

        <div id="input-section" class="cta-container">
          <p>
            Convert hours of audio into structured, readable documents
          </p>
          <div class="input-wrapper">
            <input type="text" id="url-input" placeholder="Link to YouTube, Google Drive, audio, transcript, or upload" />
            <label for="file-upload" class="upload-button">
              <span class="upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
              </span>
              <input
                type="file"
                id="file-upload"
                accept=".srt,.wav,.ogg,.vtt,.mp3,.mp4,.m4a"
                style="display: none"
                onchange="onConvertClick()"
              />
            </label>
          </div>
          <a href="#" class="cta" onclick="onConvertClick()">Convert</a>
        </div>

        <div id="done-section" class="cta-container hidden">
          <div class="success-icon">&#10004;</div>
          <p>
            Done! Please check your e-mail inbox in a few minutes.
          </p>
          <button onclick="reset()" class="cta">Got it!</button>
        </div>
        <style>
          .success-icon {
            font-size: 48px;
            color: #4CAF50;
            margin-bottom: 15px;
          }
        
          #done-section {
            background-color: #E8F5E9;
            border: 2px solid #4CAF50;
          }
        
          #done-section p {
            font-size: 1.2em;
            font-weight: 600;
            color: #2E7D32;
          }
        
          #done-section .cta {
            background-color: #4CAF50;
          }
        
          #done-section .cta:hover {
            background-color: #45a049;
          }
        </style>
        <div id="status-section" class="cta-container hidden">
          <p>
            Working on it. You will receive an email from Artyom Astafurov once ready.
          </p>
          <p>
            Processing time is quick - about 5 mins for each hour of content. Hang tight!
          </p>
          <div id="animation-container">
            <div id="runner"></div>
            <p id="processing-stage"></p>
          </div>
          <!-- <button onclick="reset()">Cancel</button> -->
        </div>
        <style>
          #animation-container {
            position: relative;
            width: 200px;
            height: 200px;
            border: 2px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
          }
          #runner {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #00008b;
            border-radius: 50%;
            animation: run 8s linear infinite;
          }
          #processing-stage {
            text-align: center;
            font-weight: bold;
            position: absolute;
            width: 100%;
            padding: 10px;
          }
          @keyframes run {
            0%, 100% { top: -10px; left: -10px; }
            25% { top: -10px; left: calc(100% - 10px); }
            50% { top: calc(100% - 10px); left: calc(100% - 10px); }
            75% { top: calc(100% - 10px); left: -10px; }
          }
        </style>
        <script>
          const processingStages = [
            "Byte Whispering", "Qubit Juggling", "Syntax Gymnastics",
            "Pixel Wrangling", "Neuron Tickling", "Algorithm Disco",
            "Data Origami", "Bit Barbecue", "Logic Limbo",
            "Quantum Knitting"
          ];
          let currentStageIndex = 0;
          
          function updateProcessingStage() {
            document.getElementById('processing-stage').textContent = processingStages[currentStageIndex];
            currentStageIndex = (currentStageIndex + 1) % processingStages.length;
          }
        
          setInterval(updateProcessingStage, 3000);
          updateProcessingStage(); // Initial update
        </script>
        <div id="error-section" class="cta-container hidden">
          <p>An error occurred. Please try again.</p>
          <button onclick="reset()" class="cta">Reset</button>
        </div>

        <section class="features-section">
          <style>
            .features-grid {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 20px;
              justify-content: start;
              align-items: stretch;
            }
            .feature-card {
              background-color: #f5f5f5;
              border-radius: 8px;
              padding: 20px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              text-align: left;
            }
            .feature-card h3 {
              margin-top: 0;
              font-size: 1.2em;
              color: var(--dark-blue);
              text-align: left;
            }
            .feature-card p {
              font-size: 0.9em;
              color: #555;
            }
            @media (max-width: 768px) {
              .features-grid {
                grid-template-columns: 1fr;
              }
            }
          </style>
          <div class="features-grid">
            <div class="feature-card">
              <h3>Sparks Joy</h3>
              <p>
                Platogram doesn't just transcribe - it transforms speech into
                high-quality, readable documents optimized for knowledge
                retrieval.
              </p>
            </div>
            <div class="feature-card">
              <h3>Privacy First</h3>
              <p>
                Your data stays yours. We process without storing, ensuring your
                sensitive information remains confidential.
              </p>
            </div>
            <div class="feature-card">
              <h3>Just Works</h3>
              <p>
                Drop a link or a file with audio or transcript and we will
                e-mail you a well-organized, readable document.
              </p>
            </div>
          </div>
        </section>

        <section class="examples-section">
          <h2>Examples</h2>
          <style>
            .examples-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 20px;
              justify-content: start;
              align-items: start;
            }
            .example-card {
              background-color: #f5f5f5;
              border-radius: 8px;
              padding: 20px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              text-align: left;
            }
            .example-card h3 {
              margin-top: 0;
              font-size: 1.2em;
              color: var(--dark-blue);
              text-align: left;
            }
            .example-card .sample-link {
              display: inline-block;
              margin: 10px 0;
              color: var(--medium-blue);
              text-decoration: none;
              font-weight: bold;
            }
            .example-card .example-description {
              font-size: 0.9em;
              color: #555;
            }
          </style>
          <div class="examples-grid">
            <div class="example-card">
              <h3>John Carmack: From Gaming Pioneer to AI Visionary</h3>
              <a href="https://drive.google.com/file/d/1_w9mv4_mBVSwK4NSnybGXtRysaT7ROFT/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">Transform a 5-hour podcast into a structured document that sparks joy.</p>
            </div>
            
            <div class="example-card">
              <h3>Hair Cells: The Remarkable Sensory Receptors of Hearing</h3>
              <a href="https://drive.google.com/file/d/1Kswr1tMuS6c0a0tNn9OCuZCuPuP0FLr-/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">Convert this inspiring TED talk into a readable format with key insights highlighted.</p>
            </div>
            
            <div class="example-card">
              <h3>Court Hearing: Data Disclosure and Trial Scheduling</h3>
              <a href="https://drive.google.com/file/d/1c_70MVz0fb7Zh0teirYt6Pc6S1hMomKV/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">See how Platogram transforms courtroom transcript into a structured document.</p>
            </div>
            
            <div class="example-card">
              <h3>Building and Training GPT-2 from Scratch</h3>
              <a href="https://drive.google.com/file/d/1w98NFdfeSObpgr-Tmm40zB2UOYctWTaS/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">Experience how a complex academic lecture is transformed into a structured, citable document.</p>
            </div>
            
            <div class="example-card">
              <h3>Intel Q2 2024 Earnings Call: Restructuring and Cost Cutting</h3>
              <a href="https://drive.google.com/file/d/14HFC36r6xLGBCDrSUdRTi50Z8SXCHD7q/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">Observe how Platogram captures and organizes key points from a business discussion.</p>
            </div>
            <div class="example-card">
              <h3>Conversation with Mark Zuckerberg</h3>
              <a href="https://drive.google.com/file/d/1DbtND485AFmUv4XVb4mgZgXo27JxdkzE/view?usp=drive_link" target="_blank" class="sample-link">View sample output</a>
              <p class="example-description">Insights on AI, entrepreneurship, and personal growth in a readable format.</p>
            </div>
          </div>
        </section>

        <section class="use-cases-section">
          <h2>Use Cases</h2>
          <style>
            .use-cases-grid {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 20px;
              justify-content: center;
            }
            .use-case-card {
              background-color: #f5f5f5;
              border-radius: 8px;
              padding: 20px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              text-align: left;
              display: flex;
              flex-direction: column;
            }
            .use-case-card h3 {
              margin-top: 0;
              font-size: 1.2em;
              color: var(--dark-blue);
              text-align: left;
            }
            .use-case-card p {
              font-size: 0.9em;
              color: #555;
              flex-grow: 1;
            }
            @media (max-width: 768px) {
              .use-cases-grid {
                grid-template-columns: 1fr;
              }
            }
          </style>
          <div class="use-cases-grid">
            <div class="use-case-card">
              <h3>Learning</h3>
              <p>
                Turn podcasts, lectures, and interviews into readable, searchable,
                shareable documents.
              </p>
            </div>
            <div class="use-case-card">
              <h3>Drafting</h3>
              <p>
                Convert raw ideas and discussions into polished drafts for legal
                briefs, academic papers, and research proposals, streamlining
                the writing process.
              </p>
            </div>
            <div class="use-case-card">
              <h3>Professional</h3>
              <p>
                Capture key insights from business meetings, coaching sessions,
                and client calls, ensuring no valuable information is lost.
              </p>
            </div>
          </div>
        </section>
        <section class="pricing-section">
          <h2>Flexible Pricing</h2>
          <div class="price-highlight">
            <span class="price">$2</span>
            <span class="per-hour">per hour of audio processed</span>
          </div>
          <p class="price-description">Suggested price, but you choose what to pay</p>
          <ul class="pricing-benefits">
            <li>Your contribution helps cover infrastructure costs</li>
            <li>It also supports ongoing development</li>
          </ul>
        </section>
        <style>
          .pricing-section {
            background-color: var(--lighter-gray);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            text-align: center;
          }
          .price-highlight {
            margin: 20px 0;
          }
          .price {
            font-size: 3em;
            font-weight: bold;
            color: var(--dark-blue);
          }
          .per-hour {
            font-size: 1.2em;
            color: var(--medium-blue);
          }
          .price-description {
            font-style: italic;
            margin-bottom: 20px;
            color: var(--dark-blue);
          }
          .pricing-benefits {
            list-style-type: none;
            padding: 0;
          }
          .pricing-benefits li {
            margin: 10px 0;
            color: var(--dark-blue);
          }
        </style>
      </main>
      <footer>
        <p>
          Platogram is built with 💜 in New York and Boston by
          <a
            href="https://codeanyway.com"
            target="_blank"
            rel="noopener noreferrer"
            >Code Anyway, Inc</a
          >
          in 2023-2024.
        <p>
          <a href="https://github.com/code-anyway/platogram" target="_blank"
          >View Source Code on GitHub</a>
        </p>
        </p>
      </footer>
    </div>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
      let auth0Client = null;

      // Initialize Auth0
      async function initAuth0() {
        try {
          auth0Client = await auth0.createAuth0Client({
            domain: "dev-df8axtz2fh7qc2n2.us.auth0.com",
            clientId: "oamC4opFTmNhvswdIGFAk7YXE6r9pQoE",
            authorizationParams: {
              redirect_uri: window.location.origin,
              audience: "https://web.platogram.ai",
              scope: "openid profile email",
            },
            cacheLocation: "localstorage",
            // useRefreshTokens: true,
          });
          console.log("Auth0 client initialized successfully");

          // Check for the code and state parameters
          const query = window.location.search;
          if (query.includes("code=") && query.includes("state=")) {
            await auth0Client.handleRedirectCallback();
            window.history.replaceState({}, document.title, "/");
          }

          await updateUI();
        } catch (error) {
          console.error("Error initializing Auth0:", error);
        }
      }

      let stripe, elements, card;

      // Initialize Stripe
      function initStripe() {
        stripe = Stripe('pk_live_51M7o8vFSngJcZDqfHcvpYSTIJ2TKO4SOlRKYrhkCe2HL8oXnoiCcKDuNluTjBwJsjIqBHHIONNAjFn1mC1qQ1HON00kuu0frmg');
        elements = stripe.elements();
        card = elements.create('card');
        card.mount('#card-element');
      }

      // Handle form submission
      async function handleSubmit(event) {
        // hide input section
        document.getElementById('input-section').classList.add('hidden');
        event.preventDefault();
        
        const price = document.getElementById('price-input').value;
        const language = document.getElementById('lang-select').value;
        
        if (price > 0) {
          try {
            const { token, error } = await stripe.createToken(card);
            if (error) {
              const errorElement = document.getElementById('card-errors');
              errorElement.textContent = error.message;
            } else {
              document.getElementById('language-modal').classList.add('hidden');
              const inputData = getInputData();
              await postToConvert(inputData, language, token.id, price);
            }
          } catch (error) {
            console.error('Error:', error);
            const errorElement = document.getElementById('card-errors');
            errorElement.textContent = 'An error occurred. Please try again.';
          }
        } else {
          document.getElementById('language-modal').classList.add('hidden');
          const inputData = getInputData();
          await postToConvert(inputData, language, null, 0);
        }
      }

      function updateUIStatus(status, errorMessage = "") {
        const inputSection = document.getElementById("input-section");
        const statusSection = document.getElementById("status-section");
        const errorSection = document.getElementById("error-section");
        const doneSection = document.getElementById("done-section");

        inputSection.classList.add("hidden");
        statusSection.classList.add("hidden");
        errorSection.classList.add("hidden");
        doneSection.classList.add("hidden");

        switch (status) {
          case "running":
            statusSection.classList.remove("hidden");
            break;
          case "done":
            doneSection.classList.remove("hidden");
            break;
          case "idle":
            inputSection.classList.remove("hidden");
            break;
          case "failed":
            errorSection.classList.remove("hidden");
            errorSection.querySelector("p").textContent =
              errorMessage || "An error occurred. Please try again.";
            break;
        }
      }

      // Update UI based on authentication state
      async function updateUI() {
        const isAuthenticated = await auth0Client.isAuthenticated();
        document
          .getElementById("login-button")
          .classList.toggle("hidden", isAuthenticated);
        document
          .getElementById("logout-button")
          .classList.toggle("hidden", !isAuthenticated);

        document.getElementById('language-modal').classList.add('hidden');

        if (isAuthenticated) {
          const user = await auth0Client.getUser();
          const token = await auth0Client.getTokenSilently({
            audience: "https://web.platogram.ai",
          });
          pollStatus(token);
          console.log("Logged in as:", user.email);
        }
      }

      async function reset() {
        try {
          const token = await auth0Client.getTokenSilently({
            audience: "https://web.platogram.ai",
          });

          // Call the /reset endpoint
          const response = await fetch("/reset", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to reset");
          }

          // Clear input fields
          document.getElementById("url-input").value = "";

          // Poll status after reset
          pollStatus(token);
        } catch (error) {
          console.error("Error resetting:", error);
          updateUIStatus("error", "Failed to reset. Please try again.");
        }
      }

      function closeLanguageModal() {
        document.getElementById('language-modal').classList.add('hidden');
      }

      // Event listener for the Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          closeLanguageModal();
        }
      });

      // Update event listeners
      document.getElementById('cancel-btn').onclick = closeLanguageModal;
      document.getElementById('submit-btn').onclick = handleSubmit;

      function selectLanguage(lang) {
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('selected'));
        document.getElementById(`${lang}-btn`).classList.add('selected');
      }

      // Initialize Stripe when the modal is shown
      function showLanguageModal() {
        document.getElementById('language-modal').classList.remove('hidden');
        if (!stripe) {
          initStripe();
        }
      }

      // Handle the 'Convert' button click
      async function onConvertClick() {
        const inputData = getInputData();
        if (await auth0Client.isAuthenticated()) {
          showLanguageModal();
        } else {
          login();
        }
      }

      function getInputData() {
        const urlInput = document.getElementById("url-input").value;
        const fileInput = document.getElementById("file-upload").files[0];
        return urlInput || fileInput;
      }

      // Login
      async function login() {
        try {
          await auth0Client.loginWithRedirect({
            authorizationParams: {
              redirect_uri: window.location.origin,
            },
          });
        } catch (error) {
          console.error("Error logging in:", error);
        }
      }

      // Logout
      async function logout() {
        try {
          await auth0Client.logout({
            logoutParams: {
              returnTo: window.location.origin,
            },
          });
        } catch (error) {
          console.error("Error logging out:", error);
        }
      }

      async function postToConvert(inputData, lang, token, price) {
        let body;
        let headers = {
          Authorization: `Bearer ${await auth0Client.getTokenSilently({
            audience: "https://web.platogram.ai",
          })}`,
        };

        const formData = new FormData();
        formData.append('lang', lang);

        formData.append('price', price);
        formData.append('token', token);

        if (inputData instanceof File) {
          formData.append('file', inputData);
        } else {
          formData.append("payload", inputData);
        }

        body = formData;
        
        try {
          const token = await auth0Client.getTokenSilently({
            audience: "https://web.platogram.ai",
          });
          const response = await fetch("/convert", {
            method: "POST",
            headers: headers,
            body: body,
          });
          const result = await response.json();

          if (result.message === "Conversion started") {
            pollStatus(token);
          } else {
            updateUIStatus("error", "Unexpected response from server");
          }
        } catch (error) {
          console.error("Error:", error);
          updateUIStatus("error", error);
        }
      }

      async function pollStatus(token) {
        try {
          const response = await fetch("/status", {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });
          const result = await response.json();

          if (result.status === "running") {
            updateUIStatus("running");
            setTimeout(() => pollStatus(token), 5000); // Poll every 5 seconds
          } else if (result.status === "idle") {
            updateUIStatus("idle");
          } else if (result.status === "failed") {
            updateUIStatus("failed", result.error);
          } else if (result.status === "done") {
            updateUIStatus("done");
          } else {
            updateUIStatus("failed", response.error);
          }
        } catch (error) {
          console.error("Error polling status:", error);
          updateUIStatus("error", error);
        }
      }

      // Initialize the app
      initAuth0().catch((error) =>
        console.error("Error initializing app:", error)
      );
    </script>
    <!-- Start of LiveChat (www.livechat.com) code -->
    <script>
      window.__lc = window.__lc || {};
      window.__lc.license = 18397149;
      window.__lc.integration_name = "manual_onboarding";
      window.__lc.product_name = "livechat";
      (function (n, t, c) {
        function i(n) {
          return e._h ? e._h.apply(null, n) : e._q.push(n);
        }
        var e = {
          _q: [],
          _h: null,
          _v: "2.0",
          on: function () {
            i(["on", c.call(arguments)]);
          },
          once: function () {
            i(["once", c.call(arguments)]);
          },
          off: function () {
            i(["off", c.call(arguments)]);
          },
          get: function () {
            if (!e._h)
              throw new Error(
                "[LiveChatWidget] You can't use getters before load."
              );
            return i(["get", c.call(arguments)]);
          },
          call: function () {
            i(["call", c.call(arguments)]);
          },
          init: function () {
            var n = t.createElement("script");
            (n.async = !0),
              (n.type = "text/javascript"),
              (n.src = "https://cdn.livechatinc.com/tracking.js"),
              t.head.appendChild(n);
          },
        };
        !n.__lc.asyncInit && e.init(),
          (n.LiveChatWidget = n.LiveChatWidget || e);
      })(window, document, [].slice);
    </script>
    <noscript
      ><a href="https://www.livechat.com/chat-with/18397149/" rel="nofollow"
        >Chat with us</a
      >, powered by
      <a
        href="https://www.livechat.com/?welcome"
        rel="noopener nofollow"
        target="_blank"
        >LiveChat</a
      ></noscript
    >
    <!-- End of LiveChat code -->
  </body>
</html>
